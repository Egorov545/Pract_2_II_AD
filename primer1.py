import pandas as pd
import numpy as np


data = {
    'Дата': ['2024-01-01', '2024-01-01', '2024-01-01', '2024-01-02', '2024-01-02',
             '2024-01-03', '2024-01-03', '2024-01-04', '2024-01-04', '2024-01-05'],
    'Товар': ['Хлеб', 'Молоко', 'Яблоки', 'Хлеб', 'Сыр',
              'Яблоки', 'Хлеб', 'Молоко', 'Сыр', 'Молоко'],
    'Количество': [10, 50, 3, 8, 2, 7, 4, 12, 6, 5],
    'Цена': [30, 50, 80, 30, 200, 50, 80, 30, 50, 200],
    'Категория': ['Выпечка', 'Молочные', 'Фрукты', 'Выпечка', 'Молочные',
                  'Фрукты', 'Выпечка', 'Молочные', 'Молочные', 'Молочные']
}

df = pd.DataFrame(data)  # Создаем DataFrame

df['Выручка'] = df['Количество'] * df['Цена']  # Добавляем столбец с выручкой, который рассчитывается автоматически

print('Исходные данные:')
print(df)
print('\n' + '='*50 + '\n')

# 1. Базовая информация о данных
print("a. Информация о данных:")
print(f"Размер таблицы: {df.shape}")
print("\nТипы данных:")
print(df.dtypes)
print("\nПроверка на пропуски:")
print(df.isnull().sum())
print("\n" + "="*50 + "\n")

# 2. Общая статистика
print("б. Общая статистика продаж:")
print(f"Общая выручка: {df['Выручка'].sum():,.1f} руб.")
print(f"Общее количество проданных товаров: {df['Количество'].sum()} шт.")
print(f"Средний чек: {df['Выручка'].mean():.1f} руб.")
print(f"Максимальная цена товара: {df['Цена'].max()} руб.")
print("\n" + "="*50 + "\n")

# 3. Анализ по товарам
print("в. Анализ по товарам:")
product_stats = df.groupby('Товар').agg({
    'Количество': 'sum',
    'Выручка': 'sum'
}).sort_values('Выручка', ascending=False)
# groupby() - группировка данных
# agg() - агрегация функций
# sort_values() - сортировка

print("Товары по выручке:")
print(product_stats)
print("\n" + "="*50 + "\n")

# 4. Анализ по категориям
print("г. Анализ по категориям:")
category_stats = df.groupby('Категория').agg({
    'Количество': 'sum',
    'Выручка': 'sum',
    'Товар': 'count'  # количество продаж
}).rename(columns={'Товар': 'Количество_продаж'})

print("Категории товаров:")
print(category_stats)
print("\n" + "="*50 + "\n")

# 3. Найти самый продаваемый товар
most_popular_product = df.groupby('Товар')['Количество'].sum().idxmax()
most_popular_count = df.groupby('Товар')['Количество'].sum().max()
# sum(), mean(), max(), min() - статистические функции

print("2. Самый популярный товар:")
print(f"Самый продаваемый товар: {most_popular_product} ({most_popular_count} шт.)")
print("\n" + "="*50 + "\n")

# 4. Посчитать выручку по дням недели
print("Анализ по датам:")
date_stats = df.groupby('Дата').agg({
    'Выручка': 'sum',
    'Количество': 'sum'
}).sort_values('Дата')

print("Выручка по дням:")
print(date_stats)
print("\n" + "="*50 + "\n")

#Топ-3 товара по выручке
print("3. Топ-3 товара по выручке:")
top_3_product = df.groupby('Товар')['Выручка'].sum().nlargest(3)
# nlargest() - топ-N значений
for i, (product, revenue) in enumerate(top_3_product.items(), 1):
    print(f"{i}. {product}: {revenue:,} руб.")

print("\n" + "=" * 50 + "\n")

# Средняя цена по категориям
print("4. Средняя цена по категорям:")
avg_price_by_category = df.groupby('Категория')['Цена'].mean()
print(avg_price_by_category.round(2))
